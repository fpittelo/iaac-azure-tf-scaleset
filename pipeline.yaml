###  Test Pipeline

 trigger:
 - feature

 pool:
   vmImage: 'ubuntu-latest'

 steps:

  - task: TerraformInstaller@0
    inputs:
      terraformVersion: 'latest'

  - task: DownloadGitHubRelease@0
    inputs:
      connection: 'github.com_fpittelo'
      userRepository: 'fpittelo/iaac-azure-tf-scaleset'
      defaultVersionType: 'specificVersion'
      version: '89111180'
      downloadPath: '$(System.ArtifactsDirectory)'

  - task: TerraformTaskV3@3
    inputs:
      provider: 'azurerm'
      command: 'init'
      workingDirectory: '$(System.ArtifactsDirectory)'
      backendServiceArm: 'Pay-As-You-Go(a6f24a81-7804-44a9-b074-25a9781afd24)'
      backendAzureRmResourceGroupName: 'FRED'
      backendAzureRmStorageAccountName: 'iaaclabs'
      backendAzureRmContainerName: 'iaacazuretfscaleset'
      backendAzureRmKey: 'terraform.tfstate'

  - task: TerraformTaskV3@3
    inputs:
      provider: 'azurerm'
      command: 'validate'
      workingDirectory: '$(System.ArtifactsDirectory)'

  - task: TerraformTaskV3@3
    inputs:
      provider: 'azurerm'
      command: 'plan'
      workingDirectory: '$(System.ArtifactsDirectory)'
      environmentServiceNameAzureRM: 'Pay-As-You-Go(a6f24a81-7804-44a9-b074-25a9781afd24)'